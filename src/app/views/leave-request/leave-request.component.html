<div class="row  align-items-center">
  <div class="col-12 col-md-4"><span>Leave Requests</span></div>
  <div class=" col-12 col-md-4 ms-auto text-end">
  </div>
</div>

<c-tabs [activeItemKey]="0">
  <c-tabs-list variant="pills" class="bg-light p-2 rounded shadow-sm">
    <button cTab [itemKey]="0" class="btn me-2">All Leaves</button>
    <button cTab [itemKey]="1" class="btn me-2">Casual Leaves</button>
    <button cTab [itemKey]="2" class="btn">Sick Leaves</button>
  </c-tabs-list>

  <c-tabs-content class="mt-3">
    <c-tab-panel [itemKey]="0" class="bg-white p-4 rounded shadow-sm border">
      <!-- <h5 class="text-primary mb-3 ">All Leaves</h5>
      <button class="btn btn-outline-success" (click)='addLeave()'>âž• Add</button> -->
      <div class="row  align-items-center">
        <div class="col-md-4">
          <h5 class="mb-3 ">All Leaves</h5>
        </div>

        <div class="col-md-4 text-center">
          <select [(ngModel)]="selectedEmployeeId" (change)="onEmployeeChange()" name="employeeSelect"
            class="form-select" required>
            <option value="">All</option>
            <option *ngFor="let emp of employeeList" [value]="emp">
              {{ emp }}
            </option>
          </select>
        </div>

        <div class="col-md-4 ms-auto text-end"><button class="btn btn-outline-success" (click)='addLeave()'>
            Apply Leave</button>
        </div>
      </div>

      <div class="text-center my-4" *ngIf="isLoading">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
      <table class="table-responsive">

        <thead class="table" id="thead">
          <tr>
            <th>S.No</th>
            <th>Employee Name</th>
            <th class="d-none d-md-table-cell">Leave Day</th>
            <th class="d-none d-md-table-cell">Leave Type</th>
            <th class="d-none d-md-table-cell">Start Date</th>
            <th class="d-none d-md-table-cell">End Date</th>
            <th class="d-none d-md-table-cell">Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let list of leaveRequests;let i = index">
            <td>{{i+1}}</td>
            <td>{{list.name}}</td>
            <td class="d-none d-md-table-cell">{{ list.leave_day}}</td>
            <td class="d-none d-md-table-cell">{{ list.leave_type }}</td>
            <td class="d-none d-md-table-cell">{{ list.start_date | date: 'yyyy-MM-dd'}}</td>
            <td class="d-none d-md-table-cell">{{ list.end_date | date: 'yyyy-MM-dd'}}</td>
            <td class="d-none d-md-table-cell">{{ list.status}}</td>
            <td>
              <button class="btn" data-bs-toggle="modal" data-bs-target="#reviewModal" id="reviewTable"
                (click)="review(list)">
                <svg [cIcon]="icons.cilCommentSquare" size="xl" title="List Icon"></svg>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </c-tab-panel>

    <!-- Casual Leaves -->
    <c-tab-panel [itemKey]="1" class="bg-white p-4 rounded shadow-sm border">
      <!-- <h5 class="text-success mb-3">Casual Leaves</h5> -->
      <div class="row  align-items-center">
        <div class="col-md-4">
          <h5 class="mb-3">Casual Leaves</h5>
        </div>
        <div class="col-md-4 text-center">
          <select [(ngModel)]="selectedEmployeeId" (change)="onEmployeeChange()" name="employeeSelect"
            class="form-select" required>
            <option value="">All</option>
            <option *ngFor="let emp of employeeList" [value]="emp">
              {{ emp }}
            </option>
          </select>
        </div>
        <div class="col-md-4 ms-auto text-end"><button class="btn btn-outline-success" (click)='addLeave()'>Apply
            Leave</button>
        </div>
      </div>
      <table class="table">
        <thead class="">
          <tr>
            <th>S.No</th>
            <th>Employee Name</th>
            <th class="d-none d-md-table-cell">Leave Day</th>
            <th class="d-none d-md-table-cell">Leave Type</th>
            <th class="d-none d-md-table-cell">Start Date</th>
            <th class="d-none d-md-table-cell">End Date</th>
            <th class="d-none d-md-table-cell">Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let list of CasualLeave; let i = index">
            <td>{{i+1}}</td>
            <td>{{list.name}}</td>
            <td class="d-none d-md-table-cell">{{ list.leave_day }}</td>
            <td class="d-none d-md-table-cell">{{ list.leave_type }}</td>
            <td class="d-none d-md-table-cell">{{ list.start_date | date: 'yyyy-MM-dd'}}</td>
            <td class="d-none d-md-table-cell">{{ list.end_date | date: 'yyyy-MM-dd'}}</td>
            <td class="d-none d-md-table-cell">{{ list.status}}</td>
            <td>
              <button class="btn" data-bs-toggle="modal" data-bs-target="#reviewModal" id="reviewTable"
                (click)="review(list)">
                <svg [cIcon]="icons.cilCommentSquare" size="xl" title="List Icon"></svg>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </c-tab-panel>

    <!-- Sick Leaves -->
    <c-tab-panel [itemKey]="2" class="bg-white p-4 rounded shadow-sm border">
      <!-- <h5 class="text-danger mb-3">Sick Leaves</h5> -->
      <div class="row  align-items-center">
        <div class="col-md-4">
          <h5 class="mb-3">Sick Leaves</h5>
        </div>
        <div class="col-md-4 text-center">
          <select [(ngModel)]="selectedEmployeeId" (change)="onEmployeeChange()" name="employeeSelect"
            class="form-select" required>
            <option value="">All</option>
            <option *ngFor="let emp of employeeList" [value]="emp">
              {{ emp }}
            </option>
          </select>
        </div>
        <div class="col-md-4 ms-auto text-end"><button class="btn btn-outline-success" (click)='addLeave()'>Apply
            Leave</button>
        </div>
      </div>
      <table class="table">
        <thead class="">
          <tr>
            <th>S.No</th>
            <th>Employee Name</th>
            <th class="d-none d-md-table-cell">Leave Day</th>
            <th class="d-none d-md-table-cell">Leave Type</th>
            <th class="d-none d-md-table-cell">Start Date</th>
            <th class="d-none d-md-table-cell">End Date</th>
            <th class="d-none d-md-table-cell">Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let list of SickLeave;let i = index">
            <td>{{i+1}}</td>
            <td>{{list.name}}</td>
            <td class="d-none d-md-table-cell">{{ list.leave_day }}</td>
            <td class="d-none d-md-table-cell">{{ list.leave_type }}</td>
            <td class="d-none d-md-table-cell">{{ list.start_date | date: 'yyyy-MM-dd'}}</td>
            <td class="d-none d-md-table-cell">{{ list.end_date | date: 'yyyy-MM-dd'}}</td>
            <td class="d-none d-md-table-cell">{{ list.status}}</td>
            <td>
              <button class="btn" data-bs-toggle="modal" data-bs-target="#reviewModal" id="reviewTable"
                (click)="review(list)">
                <svg [cIcon]="icons.cilCommentSquare" size="xl" title="List Icon"></svg>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </c-tab-panel>
  </c-tabs-content>
</c-tabs>


<div class="modal fade" id="reviewModal" tabindex="-1" aria-labelledby="reviewModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header text-white">
        <h5 class="modal-title" id="reviewModalLabel">
          {{ selectedRequest?.name }} - {{ selectedRequest?.leave_day }}
        </h5>
        <button type="button" class="btn-close" id="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">


        <table class="table w-100">
          <tbody>
            <tr>
              <th style="background-color: #FFFFFF;">Status</th>
              <td style="background-color: #FFFFFF;">{{ selectedRequest?.status }}</td>
            </tr>
            <tr>
              <th style="background-color: #FFFFFF;">From</th>
              <td style="background-color: #FFFFFF;">{{ selectedRequest?.start_date| date: 'yyyy-MM-dd' }}</td>
            </tr>
            <tr>
              <th style="background-color: #FFFFFF;">To</th>
              <td style="background-color: #FFFFFF;">{{ selectedRequest?.end_date | date: 'yyyy-MM-dd'}}</td>
            </tr>
            <tr>
              <th style="background-color: #FFFFFF;">Leave Type</th>
              <td style="background-color: #FFFFFF;">{{ selectedRequest?.leave_type }}</td>
            </tr>
            <tr>
              <th style="background-color: #FFFFFF;">No of days</th>
              <td style="background-color: #FFFFFF;">{{ selectedRequest?.no_of_days }}</td>
            </tr>
            <tr>
              <th style="background-color: #FFFFFF;">Reason</th>
              <td style="background-color: #FFFFFF;">{{ selectedRequest?.leave_reason }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    
      <div class="modal-footer d-flex justify-content-between" *ngIf="role === '1'">
        <button *ngIf="selectedRequest?.status !== 'Approved'" type="button" class="btn" id="approve"
          [disabled]="isApproving" data-bs-dismiss="modal" (click)="approve()">
          Approve
        </button>

        <button type="button" class="btn" id="reject" data-bs-dismiss="modal"
          [disabled]="isApproving || selectedRequest?.status === 'Rejected'" (click)="reject()">
          Reject
        </button>
      </div>

    </div>
  </div>
</div>




